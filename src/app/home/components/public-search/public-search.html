<div class="overlay" (click)="onCancel()" *ngIf="showSearchOverlay">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="PublicSearchTitle" (click)="$event.stopPropagation()">

    <!-- Header -->
    <header class="modal-header">
      <h2 id="PublicSearchTitle">Certified Search Report (CSR)</h2>
      <button class="close-btn" aria-label="Close" (click)="onCancel()">
        <i class="fas fa-times"></i>
      </button>
    </header>

    <!-- Info Section -->
    <div class="info-section">
      <div class="info-title">
        <span class="info-icon">i</span>
        <h3>Search Instructions</h3>
      </div>
      <div class="info-grid">
        <div class="info-box">
          <h4>1. Applicable Fees</h4>
          <ul>
            <li>For institutions/companies/agencies: Nu. 200 per report</li>
            <li>For individuals: Nu. 100 per report</li>
          </ul>
        </div>
        <div class="info-box">
          <h4>2. Report Results</h4>
          <ul>
            <li><b>HIT:</b> Collateral is mortgaged with a bank. Contact concerned bank official for enquiries.</li>
            <li><b>NO-HIT:</b> No mortgage record found against any bank.</li>
          </ul>
        </div>
        <div class="info-box">
          <h4>3. Validity of Vehicle Reports</h4>
          <p>For vehicles, the report is valid for a maximum of two (2) weeks.</p>
        </div>
        <div class="info-box">
          <h4>4. Authenticity of CSR</h4>
          <p>The Certified Search Report will be treated as an authentic and official document by all agencies.</p>
        </div>
      </div>
    </div>

    <!-- Search Form -->
    <div class="form-section">
      <h3 class="section-header">Section A: Requester Details</h3>
      
      <form [formGroup]="form" (ngSubmit)="onSearch()" class="search-form">
        <div class="form-grid">
   <!-- Requested CID -->
     <div class="form-group">
      <label>Requester CID No.</label>
      <input type="text" formControlName="requesterCid" />
    </div>
          <!-- Requested By -->
          <div class="form-group">
            <label>Requested By</label>
            <input type="text" formControlName="requestedBy" />
          </div>
    
          <!-- Phone Number -->
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" formControlName="phoneNumber" placeholder="8-digit phone" maxlength="8" />
          </div>
     <!-- email -->
     <div class="form-group">
      <label>Email Address</label>
      <input type="email" formControlName="email" />
    </div>
          <!-- Current Address -->
          <div class="form-group">
            <label>Current Address</label>
            <input type="text" formControlName="currentAddress" />
          </div>
   
        
        </div>
    
        <!-- Buttons -->
        
      </form>
      <div class="form-section">
        <h3 class="section-header">Section B: Collateral Details</h3>
        
        <form [formGroup]="form" (ngSubmit)="onSearch()" class="search-form">
          <div class="form-grid">
            <!-- Asset Type -->
            <div class="form-group">
              <label>Asset Type</label>
              <select formControlName="assetType" (change)="onAssetTypeChange()">
                <option value="" disabled selected>-- Select --</option>
                <option *ngFor="let type of assetTypes" [value]="type">{{ type }}</option>
              </select>
            </div>
      
            <!-- Debtor Type -->
            <div class="form-group">
              <label>Debtor Type</label>
              <select formControlName="debtorType">
                <option value="" disabled selected>-- Select --</option>
                <option *ngFor="let d of debtorTypeOptions" [value]="d.value">{{ d.label }}</option>
              </select>
            </div>

            <!-- CID No. for Individual -->
            <ng-container *ngIf="form.get('debtorType')?.value === 'ind'">
              <div class="form-group">
                <label>CID No.</label>
                <input type="text" formControlName="cidOrInstitutionNo" />
              </div>
            </ng-container>

            <!-- Institution ICD for Institute -->
            <ng-container *ngIf="form.get('debtorType')?.value === 'ins'">
              <div class="form-group">
                <label>Institution ICD</label>
                <input type="text" formControlName="cidOrInstitutionNo" />
              </div>
            </ng-container>
      
            <!-- Applicable Fee -->
            <div class="form-group">
              <label>Applicable Fee (Nu.)</label>
              <input type="text" formControlName="applicableFee" readonly />
            </div>
      
            <!-- Collateral Type -->
            <div class="form-group">
              <label>Collateral Type</label>
              <select formControlName="collateralType" (change)="onCollateralTypeChange($event)">
                <option value="" disabled selected>-- Select --</option>
                <ng-container *ngIf="form.get('assetType')?.value === 'Movable'">
                <optgroup label="Serial Based Collaterals">
                  <option
                    *ngFor="let collateral of serialCollaterals"
                    [value]="collateral.collateralId"
                    [attr.data-name]="collateral.collateral"
                  >
                    {{ collateral.collateral }}
                  </option>
                </optgroup>
                <optgroup label="General Based Collaterals">
                  <option
                    *ngFor="let collateral of generalCollaterals"
                    [value]="collateral.collateralId"
                    [attr.data-name]="collateral.collateral"
                  >
                    {{ collateral.collateral }}
                  </option>
                </optgroup>
              </ng-container>
              <ng-container *ngIf="form.get('assetType')?.value === 'Immovable'">
                <optgroup label="Immovable Collaterals">
                  <option
                    *ngFor="let collateral of nonMovableCollaterals"
                    [value]="collateral.collateralId"
                    [attr.data-name]="collateral.collateral"
                  >
                    {{ collateral.collateral }}
                  </option>
                </optgroup>
              </ng-container>
                <!-- <option *ngFor="let col of collateralList" [value]="col.collateralId">{{ col.collateralType }}</option> -->
              </select>
            </div>

            <!-- Movable Asset Fields -->
            <ng-container *ngIf="form.get('assetType')?.value === 'Movable'">
              <div class="form-group">
                <label>Vehicle No.</label>
                <input type="text" formControlName="vehicleNo" />
              </div>
              <div class="form-group">
                <label>Purpose</label>
                <select formControlName="purpose">
                  <option value="" disabled selected>--Select--</option>
                  <option *ngFor="let purpose of purposes" [value]="purpose.id">{{ purpose.name }}</option>
                </select>
              </div>
            </ng-container>

            <!-- Immovable Asset - Land Fields -->
            <ng-container *ngIf="form.get('assetType')?.value === 'Immovable' && form.get('collateralTypeName')?.value === 'Land'">
             
              <div class="form-group">
                <label>Dzongkhag</label>
                <select formControlName="dzongkhag">
                  <option value="" disabled selected>-- Select Dzongkhag --</option>
                  <option *ngFor="let dz of dzongkhagList" [ngValue]="dz">
                    {{ dz.name || dz.dzongkhagName || dz.dzongkhag || dz.description || dz.title }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label>Gewog</label>
                <select formControlName="gewog">
                  <option value="" disabled selected>-- Select Gewog --</option>
                  <option *ngFor="let gw of gewogList" [ngValue]="gw">
                    {{ gw.name || gw.gewogName || gw.gewog || gw.description || gw.title }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label>Thram No.</label>
                <input type="text" formControlName="thramNo" />
              </div>
              <div class="form-group">
                <label>Plot ID</label>
                <input type="text" formControlName="plotId" />
              </div>
              <div class="form-group">
                <label>Purpose</label>
                <select formControlName="purpose">
                  <option value="" disabled selected>--Select--</option>
                  <option *ngFor="let purpose of purposes" [value]="purpose.id">{{ purpose.name }}</option>
                </select>
              </div>
            </ng-container>

            <!-- Immovable Asset - Strata Fields -->
            <ng-container *ngIf="form.get('assetType')?.value === 'Immovable' && form.get('collateralTypeName')?.value === 'Strata'">
              <div class="form-group">
                <label>Dzongkhag</label>
                <select formControlName="dzongkhag">
                  <option value="" disabled selected>-- Select Dzongkhag --</option>
                  <option *ngFor="let dz of dzongkhagList" [ngValue]="dz">
                    {{ dz.name || dz.dzongkhagName || dz.dzongkhag || dz.description || dz.title }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label>Gewog</label>
                <select formControlName="gewog">
                  <option value="" disabled selected>-- Select Gewog --</option>
                  <option *ngFor="let gw of gewogList" [ngValue]="gw">
                    {{ gw.name || gw.gewogName || gw.gewog || gw.description || gw.title }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label>Thram No.</label>
                <input type="text" formControlName="thramNo" />
              </div>
              <div class="form-group">
                <label>Plot ID</label>
                <input type="text" formControlName="plotId" />
              </div>
              <div class="form-group">
                <label>Building No.</label>
                <input type="text" formControlName="buildingNo" />
              </div>
              <div class="form-group">
                <label>Flat No.</label>
                <input type="text" formControlName="flatNo" />
              </div>
              <div class="form-group">
                <label>Purpose</label>
                <select formControlName="purpose">
                  <option value="" disabled selected>--Select--</option>
                  <option *ngFor="let purpose of purposes" [value]="purpose.id">{{ purpose.name }}</option>
                </select>
              </div>
            </ng-container>
          </div>
      
          <!-- Buttons -->
          <div class="button-container">
            <p class="review-message">Note: Please review all details before making payment.</p>
            <div>
              <button type="submit" class="btn btn--primary">Search</button>
              <button type="button" class="btn btn--cancel" (click)="onCancel()">Cancel</button>
            </div>
          </div>
        </form>
    </div>
  </div>
</div>
